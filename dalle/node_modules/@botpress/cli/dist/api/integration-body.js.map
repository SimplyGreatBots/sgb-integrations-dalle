{
  "version": 3,
  "sources": ["../../src/api/integration-body.ts"],
  "sourcesContent": ["import type { Client, Integration } from '@botpress/client'\nimport * as utils from '../utils'\n\nexport type CreateIntegrationBody = Parameters<Client['createIntegration']>[0]\nexport type UpdateIntegrationBody = Parameters<Client['updateIntegration']>[0]\n\ntype UpdateIntegrationChannelsBody = NonNullable<UpdateIntegrationBody['channels']>\ntype UpdateIntegrationChannelBody = UpdateIntegrationChannelsBody[string]\n\ntype Channels = Integration['channels']\ntype Channel = Integration['channels'][string]\n\nexport const prepareUpdateIntegrationBody = (\n  localIntegration: UpdateIntegrationBody,\n  remoteIntegration: Integration\n): UpdateIntegrationBody => {\n  const actions = utils.records.setNullOnMissingValues(localIntegration.actions, remoteIntegration.actions)\n  const events = utils.records.setNullOnMissingValues(localIntegration.events, remoteIntegration.events)\n  const states = utils.records.setNullOnMissingValues(localIntegration.states, remoteIntegration.states)\n  const user = {\n    ...localIntegration.user,\n    tags: utils.records.setNullOnMissingValues(localIntegration.user?.tags, remoteIntegration.user?.tags),\n  }\n\n  const channels = prepareUpdateIntegrationChannelsBody(localIntegration.channels ?? {}, remoteIntegration.channels)\n\n  return {\n    ...localIntegration,\n    actions,\n    events,\n    states,\n    user,\n    channels,\n  }\n}\n\nconst prepareUpdateIntegrationChannelsBody = (\n  localChannels: UpdateIntegrationChannelsBody,\n  remoteChannels: Channels\n): UpdateIntegrationChannelsBody => {\n  const channelBody: UpdateIntegrationChannelsBody = {}\n\n  const zipped = utils.records.zipObjects(localChannels, remoteChannels)\n  for (const [channelName, [localChannel, remoteChannel]] of Object.entries(zipped)) {\n    if (localChannel && remoteChannel) {\n      // channel has to be updated\n      channelBody[channelName] = prepareUpdateIntegrationChannelBody(localChannel, remoteChannel)\n    } else if (localChannel) {\n      // channel has to be created\n      channelBody[channelName] = localChannel\n      continue\n    } else if (remoteChannel) {\n      // channel has to be deleted\n      channelBody[channelName] = null\n      continue\n    }\n  }\n\n  return channelBody\n}\n\nconst prepareUpdateIntegrationChannelBody = (\n  localChannel: UpdateIntegrationChannelBody,\n  remoteChannel: Channel\n): UpdateIntegrationChannelBody => ({\n  ...localChannel,\n  messages: utils.records.setNullOnMissingValues(localChannel?.messages, remoteChannel.messages),\n  message: {\n    ...localChannel?.message,\n    tags: utils.records.setNullOnMissingValues(localChannel?.message?.tags, remoteChannel.message.tags),\n  },\n  conversation: {\n    ...localChannel?.conversation,\n    tags: utils.records.setNullOnMissingValues(localChannel?.conversation?.tags, remoteChannel.conversation.tags),\n  },\n})\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,YAAuB;AAWhB,MAAM,+BAA+B,CAC1C,kBACA,sBAC0B;AAC1B,QAAM,UAAU,MAAM,QAAQ,uBAAuB,iBAAiB,SAAS,kBAAkB,OAAO;AACxG,QAAM,SAAS,MAAM,QAAQ,uBAAuB,iBAAiB,QAAQ,kBAAkB,MAAM;AACrG,QAAM,SAAS,MAAM,QAAQ,uBAAuB,iBAAiB,QAAQ,kBAAkB,MAAM;AACrG,QAAM,OAAO;AAAA,IACX,GAAG,iBAAiB;AAAA,IACpB,MAAM,MAAM,QAAQ,uBAAuB,iBAAiB,MAAM,MAAM,kBAAkB,MAAM,IAAI;AAAA,EACtG;AAEA,QAAM,WAAW,qCAAqC,iBAAiB,YAAY,CAAC,GAAG,kBAAkB,QAAQ;AAEjH,SAAO;AAAA,IACL,GAAG;AAAA,IACH;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;AACF;AAEA,MAAM,uCAAuC,CAC3C,eACA,mBACkC;AAClC,QAAM,cAA6C,CAAC;AAEpD,QAAM,SAAS,MAAM,QAAQ,WAAW,eAAe,cAAc;AACrE,aAAW,CAAC,aAAa,CAAC,cAAc,aAAa,CAAC,KAAK,OAAO,QAAQ,MAAM,GAAG;AACjF,QAAI,gBAAgB,eAAe;AAEjC,kBAAY,eAAe,oCAAoC,cAAc,aAAa;AAAA,IAC5F,WAAW,cAAc;AAEvB,kBAAY,eAAe;AAC3B;AAAA,IACF,WAAW,eAAe;AAExB,kBAAY,eAAe;AAC3B;AAAA,IACF;AAAA,EACF;AAEA,SAAO;AACT;AAEA,MAAM,sCAAsC,CAC1C,cACA,mBACkC;AAAA,EAClC,GAAG;AAAA,EACH,UAAU,MAAM,QAAQ,uBAAuB,cAAc,UAAU,cAAc,QAAQ;AAAA,EAC7F,SAAS;AAAA,IACP,GAAG,cAAc;AAAA,IACjB,MAAM,MAAM,QAAQ,uBAAuB,cAAc,SAAS,MAAM,cAAc,QAAQ,IAAI;AAAA,EACpG;AAAA,EACA,cAAc;AAAA,IACZ,GAAG,cAAc;AAAA,IACjB,MAAM,MAAM,QAAQ,uBAAuB,cAAc,cAAc,MAAM,cAAc,aAAa,IAAI;AAAA,EAC9G;AACF;",
  "names": []
}
